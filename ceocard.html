<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CeoCard - CRM v4.1.0</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="c-style.css">
</head>
<body data-theme="light">

<header>
    <div class="logo-container" style="display: flex; justify-content: center; align-items: center; margin-bottom: 5px;">
        <svg width="150" height="35" viewBox="0 0 150 35" xmlns="http://www.w3.org/2000/svg">
            <g transform="translate(5, 26)">
                <text x="0" y="0" font-family="'Segoe UI', -apple-system, sans-serif" font-size="28" font-weight="800" fill="#FF5722" letter-spacing="-1.5">ceo</text>
                <text x="46" y="0" font-family="'Segoe UI', -apple-system, sans-serif" font-size="28" font-weight="900" fill="#ffffff" letter-spacing="0.5">CARD</text>
            </g>
        </svg>
    </div>
    <h2 id="page-subtitle" style="margin-top: 0;">Agenda</h2>
</header>

<main id="content-area">
    <div id="timeline-view" class="container" style="display:flex;">
        <div id="dailyBriefing" class="briefing-card" style="display: none;">
            <div class="briefing-icon"><i class="fa-solid fa-bell"></i></div>
            <div class="briefing-content">
                <strong id="briefingTitle">Resumo do Dia</strong>
                <p id="briefingText">Calculando as suas obrigações...</p>
            </div>
        </div>

        <div id="dateStripContainer" class="date-strip-container"></div>

        <div class="agenda-filters" style="display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; margin-bottom: 15px; scrollbar-width: none;">
            <button class="chip-filter active" onclick="filtrarAgenda('todas')">Todas</button>
            <button class="chip-filter" onclick="filtrarAgenda('urgencias')"><i class="fa-solid fa-triangle-exclamation"></i> Urgências</button>
            <button class="chip-filter" onclick="filtrarAgenda('concluidas')"><i class="fa-solid fa-check-double"></i> Concluídas</button>
        </div>
        
        <div id="timelineList" style="width: 100%;"></div>
    </div>

    <div id="dashboard-view" class="container">
        <div style="margin-bottom: 15px; border-bottom: 2px solid var(--border-color, #eee); padding-bottom: 10px;">
            <h3 style="margin: 0; color: var(--primary); font-size: 1.1rem;"><i class="fa-solid fa-chart-pie" style="color: var(--brand-orange);"></i> Visão Geral Mensal</h3>
        </div>

        <div class="dash-grid" style="width: 100%;">
            <div class="dash-card"><i class="fa-solid fa-person-walking"></i><span id="stat-visitas">0</span><label>Visitas</label></div>
            <div class="dash-card"><i class="fa-solid fa-clock"></i><span id="stat-horas">0h</span><label>Horas</label></div>
            <div class="dash-card"><i class="fa-solid fa-check-double"></i><span id="stat-resolvidos">0</span><label>Resolvidos</label></div>
            <div class="dash-card"><i class="fa-solid fa-user-slash"></i><span id="stat-pendentes" style="color: var(--danger);">0</span><label>Inativos</label></div>
        </div>
        
        <div class="dash-card" style="width: 100%; margin: 15px 0;">
            <label id="eficiencia-label" style="font-weight: bold; color: var(--primary);">Eficiência Mensal</label>
            <div id="eficiencia-bar" style="width: 100%; height: 12px; background: var(--bg-secondary, #eee); border-radius: 6px; overflow: hidden; margin-top: 8px;">
                <div id="eficiencia-fill" style="width: 0%; height: 100%; background: var(--brand-orange);"></div>
            </div>
        </div>

        <div style="margin-top: 10px; margin-bottom: 15px; border-bottom: 2px solid var(--border-color, #eee); padding-bottom: 10px;">
            <h3 style="margin: 0; color: var(--primary); font-size: 1.1rem;"><i class="fa-solid fa-table-columns" style="color: var(--brand-orange);"></i> Funil Operacional</h3>
            <p style="margin: 5px 0 0 0; font-size: 0.75rem; color: var(--text-muted, #7f8c8d);">Status calculados automaticamente com base na movimentação mensal.</p>
        </div>

        <div id="board-container-inner" style="width: 100%; display: flex; gap: 15px; overflow-x: auto; padding-bottom: 10px;"></div>
    </div>

    <div id="clientes-view" class="container">
        <div class="search-container" style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; width: 100%;">
            <div style="position: relative; width: 100%;">
                <i class="fa-solid fa-magnifying-glass" style="position: absolute; left: 15px; top: 15px; color: var(--text-muted, #95a5a6);"></i>
                <input type="text" id="searchClient" placeholder="Filtrar por nome..." oninput="filtrarClientes()" style="padding-left: 40px; width: 100%;">
            </div>
            <div style="display: flex; gap: 10px; width: 100%;">
                <select id="filterRamo" onchange="filtrarClientes()" style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color, #ddd); background: var(--card-bg, #fff); color: var(--text-main, #2c3e50);">
                    <option value="">Todos os Ramos</option>
                </select>
                <select id="filterStatus" onchange="filtrarClientes()" style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color, #ddd); background: var(--card-bg, #fff); color: var(--text-main, #2c3e50);">
                </select>
            </div>
        </div>
        <div id="clientsList" class="clients-grid" style="width: 100%;"></div>
    </div>

    <div id="config-view" class="container">
        <button class="btn-save" style="width: 100%; margin-bottom: 20px; background: var(--brand-orange); color: white;" onclick="abrirModalNovoCliente()">
            <i class="fa-solid fa-user-plus"></i> Cadastrar Novo Cliente
        </button>

        <div class="config-list" style="gap: 20px;">
            <div style="background: var(--card-bg, white); border-radius: 12px; padding: 15px; box-shadow: var(--shadow-soft); display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border-color);">
                <div>
                    <strong style="color: var(--primary); font-size: 1.1rem;"><i class="fa-solid fa-moon" style="color: #f1c40f; margin-right: 5px;"></i> Modo Escuro</strong>
                    <div style="font-size: 0.75rem; color: var(--text-muted, #7f8c8d);">Alterar o tema visual do aplicativo</div>
                </div>
                <label class="switch">
                    <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
                    <span class="slider round"></span>
                </label>
            </div>

            <div style="background: var(--card-bg, white); border-radius: 12px; padding: 15px; box-shadow: var(--shadow-soft); border: 1px solid var(--border-color);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <strong style="color: var(--primary); font-size: 1.1rem;"><i class="fa-solid fa-briefcase" style="color: var(--brand-orange); margin-right: 5px;"></i> Ramos Ativos</strong>
                    <button class="btn-outline" style="padding: 5px 10px; border-color: var(--success, #2ecc71); color: var(--success, #2ecc71);" onclick="toggleModal('modalRamo')"><i class="fa-solid fa-plus"></i> Novo</button>
                </div>
                <div id="listaRamosConfig" style="display: flex; flex-direction: column; gap: 8px;"></div>
            </div>

            <div class="backup-section" style="background: var(--card-bg, white); border-radius: 12px; padding: 15px; box-shadow: var(--shadow-soft); border: 1px solid var(--border-color); margin-top: 0;">
                <label style="font-weight: bold; font-size: 0.9rem; color: var(--primary); display: block; margin-bottom: 10px;"><i class="fa-solid fa-shield-halved" style="color: #e67e22; margin-right: 5px;"></i> Segurança de Dados</label>
                <div style="display: flex; gap: 10px;">
                    <button class="btn-save" style="flex: 1; background: #8e44ad; color: white;" onclick="exportarDados()">
                        <i class="fa-solid fa-file-export"></i> Exportar
                    </button>
                    <label class="btn-save" style="flex: 1; background: var(--brand-dark); color: white; text-align: center; cursor: pointer;">
                        <i class="fa-solid fa-file-import"></i> Importar
                        <input type="file" id="importFile" style="display: none;" onchange="importarDados(event)">
                    </label>
                </div>
                <p style="font-size: 0.65rem; color: var(--text-muted, #999); margin-top: 8px; text-align: center;">* Exporte regularmente para garantir a segurança dos dados.</p>
            </div>
        </div>
    </div>
</main>

<nav class="bottom-nav">
    <button onclick="switchView('timeline')" class="nav-item active" id="btn-nav-timeline"><i class="fa-solid fa-calendar-days"></i><span>Agenda</span></button>
    <button onclick="switchView('dashboard')" class="nav-item" id="btn-nav-dashboard"><i class="fa-solid fa-chart-line"></i><span>Dash</span></button>
    <button onclick="toggleModal('modalAgendamento')" class="nav-item central"><i class="fa-solid fa-plus-circle"></i></button>
    <button onclick="switchView('clientes')" class="nav-item" id="btn-nav-clientes"><i class="fa-solid fa-users"></i><span>Clientes</span></button>
    <button onclick="switchView('config')" class="nav-item" id="btn-nav-config"><i class="fa-solid fa-gears"></i><span>Ajustes</span></button>
</nav>

<div id="modalCliente" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalClienteTitulo">Novo Cliente</h2>
            <span class="close" onclick="toggleModal('modalCliente')">&times;</span>
        </div>
        <form id="formCliente" class="grid-form">
            <input type="hidden" id="cliId">
            
            <div class="full-width" style="margin-bottom: 10px; background: rgba(231, 76, 60, 0.1); padding: 10px; border-radius: 8px; display: flex; align-items: center; gap: 10px; border: 1px solid rgba(231, 76, 60, 0.3);">
                <input type="checkbox" id="cliInativo" style="width: 20px; height: 20px; accent-color: #e74c3c;">
                <label for="cliInativo" style="font-size: 0.9rem; color: #e74c3c; font-weight: bold; margin:0;">Marcar Cliente como INATIVO</label>
            </div>

            <input type="text" id="cliCodigo" placeholder="Código" required>
            <input type="text" id="cliRazao" placeholder="Razão Social">
            <input type="text" id="cliFantasia" placeholder="Nome Fantasia" required>
            <select id="cliRamo" required><option value="">Selecione o Ramo</option></select>
            <input type="text" id="cliRua" placeholder="Rua" class="full-width">
            <input type="text" id="cliNumero" placeholder="Nº">
            <input type="text" id="cliBairro" placeholder="Bairro">
            <input type="text" id="cliCidade" placeholder="Cidade">
            <input type="text" id="cliEstado" placeholder="UF">
            <input type="text" id="cliContatoNome" placeholder="Contato">
            <input type="tel" id="cliTelefone" placeholder="Telefone">
            <textarea id="cliObs" placeholder="Observações" class="full-width" rows="2"></textarea>
            <button type="submit" class="btn-save full-width" style="background: var(--brand-orange);">Salvar Cliente</button>
        </form>
    </div>
</div>

<div id="modalAtendimento" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="atendClienteNome">Atendimento</h2>
            <span id="badgeFinalizado" style="display:none; background: var(--success, #2ecc71); color:white; padding:2px 8px; border-radius:10px; font-size:0.7rem;">CONCLUÍDO</span>
            <span class="close" onclick="toggleModal('modalAtendimento')">&times;</span>
        </div>
        <div class="atendimento-body">
            <div id="atendTimer" class="timer-display">00:00:00</div>
            <div id="areaBotoesAtendimento" style="display: flex; gap: 10px;">
                <button id="btnCheckIn" class="btn-checkin" onclick="realizarCheckIn()" style="flex: 1;">Check-in</button>
                <button id="btnCheckOut" class="btn-checkout" onclick="realizarCheckOut()" disabled style="flex: 1;">Check-out</button>
            </div>
            
            <label style="font-size: 0.8rem; margin-top: 10px; display: block; color: var(--text-main);">Relatório da Visita:</label>
            <textarea id="atendRelatorio" class="full-width" rows="4"></textarea>
            
            <div id="areaAnexosUpload" style="margin-top: 15px; border: 1px solid var(--border-color); padding: 10px; border-radius: 8px; background: var(--bg-secondary);">
                <label style="font-size: 0.8rem; display: block; color: var(--primary); font-weight: bold; margin-bottom: 8px;"><i class="fa-solid fa-paperclip"></i> Evidências (Fotos/Docs):</label>
                <input type="file" id="atendAnexosInput" multiple accept="image/*,video/*,.pdf,.doc,.docx" style="display: none;" onchange="processarAnexosSelecionados()">
                <button type="button" id="btnSelecionarAnexos" class="btn-outline full-width" style="border-style: dashed; padding: 10px;" onclick="document.getElementById('atendAnexosInput').click()">
                    <i class="fa-solid fa-cloud-arrow-up"></i> Adicionar Anexos
                </button>
                <div id="listaAnexosUI" style="margin-top: 10px; display: flex; flex-direction: column; gap: 5px;"></div>
            </div>

            <div id="atendConfigExtras">
                <div style="background: var(--bg-secondary, #f8f9fa); padding: 10px; border-radius: 8px; margin-top: 15px; border: 1px solid var(--border-color);">
                    <label style="font-weight: bold; font-size: 0.8rem; color: var(--primary);">Próximo Agendamento (Opcional):</label>
                    <div class="grid-form" style="margin-top: 8px;">
                        <input type="date" id="proxAgeData">
                        <input type="time" id="proxAgeHora">
                        <select id="proxAgeTipo" class="full-width">
                            <option value="Visita de Rotina">Visita de Rotina</option>
                            <option value="Urgência">Urgência</option>
                            <option value="Reunião">Reunião</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div id="areaObservacaoPos" style="display:none; margin-top: 15px; border-top: 2px dashed var(--border-color, #eee); padding-top: 10px;">
                <label style="font-size: 0.8rem; display: block; color: var(--text-main);">Nota Adicional Pós-Visita:</label>
                <textarea id="atendObsPos" class="full-width" rows="3"></textarea>
                <button class="btn-save" style="width:100%; margin-top:10px; background: var(--brand-orange);" onclick="salvarObservacaoPos()">Guardar Nota</button>
            </div>
        </div>
    </div>
</div>

<div id="modalHistorico" class="modal-overlay">
    <div class="modal-content" style="max-height: 85vh; overflow-y: auto;">
        <div class="modal-header" style="margin-bottom: 5px;">
            <h2 id="histClienteNome">Histórico</h2>
            <span class="close" onclick="toggleModal('modalHistorico')">&times;</span>
        </div>
        
        <div style="display: flex; gap: 10px; margin-bottom: 15px; background: var(--bg-secondary); padding: 10px; border-radius: 8px; border: 1px solid var(--border-color);">
            <input type="month" id="filtroHistMes" class="full-width" style="flex: 1; padding: 8px; font-size: 0.85rem;" onchange="filtrarEVisualizarHistorico()">
            <select id="filtroHistTipo" style="flex: 1; padding: 8px; font-size: 0.85rem;" onchange="filtrarEVisualizarHistorico()">
                <option value="">Todos os Tipos</option>
                <option value="Visita de Rotina">Visita</option>
                <option value="Urgência">Urgência</option>
                <option value="Reunião">Reunião</option>
            </select>
        </div>

        <div id="histLista" style="margin-top: 5px;"></div>
    </div>
</div>

<div id="modalDetalheAtendimento" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Resumo da Visita</h2>
            <span class="close" onclick="toggleModal('modalDetalheAtendimento')">&times;</span>
        </div>
        <div id="detalheAtendimentoBody" style="margin-top: 10px; display: flex; flex-direction: column; gap: 15px;">
            </div>
    </div>
</div>

<div id="modalRamo" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Novo Ramo</h2>
            <span class="close" onclick="toggleModal('modalRamo')">&times;</span>
        </div>
        <form id="formRamo">
            <input type="text" id="ramoNome" placeholder="Ex: Farmácia" required>
            <button type="submit" class="btn-save" style="width:100%; margin-top:10px; background: var(--brand-orange);">Salvar Ramo</button>
        </form>
    </div>
</div>

<div id="modalAgendamento" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Novo Agendamento</h2>
            <span class="close" onclick="toggleModal('modalAgendamento')">&times;</span>
        </div>
        
        <div id="alertaConflito" style="display:none; background:#f8d7da; color:#721c24; padding:12px; border-radius:8px; margin-bottom:15px; font-size:0.85rem; text-align:center; border: 1px solid #f5c6cb;">
            <i class="fa-solid fa-triangle-exclamation"></i> <strong id="msgConflitoTitulo">Conflito de Horário!</strong><br>
            <span id="msgConflitoTexto">Já existe um compromisso próximo a este horário.</span>
        </div>

        <form id="formAgendamento" class="grid-form">
            <select id="ageCliente" class="full-width" required></select>
            <input type="date" id="ageData" required>
            <input type="time" id="ageHora" required>
            <select id="ageTipo" class="full-width">
                <option value="Visita de Rotina">Visita de Rotina</option>
                <option value="Urgência">Urgência</option>
                <option value="Reunião">Reunião</option>
            </select>
            <button type="submit" class="btn-save full-width" style="background: var(--brand-orange);">Agendar</button>
        </form>
    </div>
</div>

<script src="c-script.js?v=4.1.0"></script>
</body>
</html>
